# BitFlyerAutoTradeBot

BitFlyerにて自動取引を行うbotです。

# 動かし方
Node.jsが動作する環境が必要です。
Linuxサーバーで常設プログラムとして動かすことを想定しています.

bot/vixrsi/vixrsi_bot.jsをnodeで起動することで稼働し始めます.

	
	$ cd BitFlyerAutoTrader
	$ npm install //初回起動時のみ
    $ cp ecosystem.config.js.sample ecosystem.config.js
    $ vi ecosystem.config.js //API_KEYとAPI_SECRETを変更
	$ pm2 start ecosystem.config.js //初回起動時のみ
	$ pm2 start bfat //2回目以降の起動時
	
# ストラテジ
[tona-bitflyer-bot](https://note.mu/tonacoin)を参考にVIX戦術で動作しています。

また、単純決済機能の他にロスカット注文/利確注文機能があります。

デフォルトではロスカット/利確共に証拠金の3%が設定されており

- ロスカットはポジション取得タイミングで3%以上の損失が出ていた場合に
- 利確はポジション取得タイミングで利益が3%を超えていた場合に機能がONになり、以降の取得で利益が3%以下になっていた場合に

注文が発生しポジションを決済します。

一部リアルタイムAPIの実装を開始し、現在ポジショニング注文のみBestBid/Askを用いて指値注文します。
発注後5秒間約定しなければ注文をキャンセルし、もう一度最新価格での発注を行います。
これを5回繰り返しても約定しない場合、注文機会をスルーします。
※これは成行注文に変更する可能性があります。


決済には成行注文を発行しますので約定漏れは恐らく発生しないものと考えられます。

また、ロスカット・利確注文は設定(vixrsi_config.js)内のlosscutPercentage/profitPercentageで設定しているためこれを書き換える事で範囲を変更することが可能です。


動作するVIX戦術は主に"押し目"で売買する戦略であるため、定期的に"崖"が発生するBTC-FXではどうしてもロスカットが発生してしまいます。

ロスカット後に通常通りの戦略で注文を続けてしまうと損失が嵩んでしまうため、現状はロスカット後はその方向のシグナルが消えるまでbotが発注を行うことはありません。

(例: 一時の跳ね上げで売り注文を発注したが、その後も値上がりが続き、ロスカットが発生した場合、値上がり中はほぼ売り注文が続いていますが、これは無視され次にノーシグナル,又は買いを認識すると動作が再開します)

現状はこの対応ですが、戦略と立案とそれをコードに書き起こすことができ次第、ロスカット後は逆注文を行うような仕組みにし、ロスを最小限に、プロフィットを最大限にする用変更を行いたいと考えています。

# おまけ

また、ニッチなターゲットですが「シストレをしてもどうしても自分で介入してしまい損失を増やしてしまう・・・」という方（以外も）に向けた発注や価格チャートは見れないが当日の取引履歴や現在のポジション、日次損益を確認できるWebAppを（こちらもβ版版ではありますが）作成いたしました。

[Github](https://github.com/ryoctrl/BitFlyerBotStatus)でご確認ください。

現状はBitFlyerのAPIに接続し各種データを取得し表示するだけのアプリですが、最終的にはこのWebアプリ上からbotのコントロール(On/Offや設定変更等)を行えればと予定しております。

# 実装予定の機能

- RealTimeAPIに対応・移行
	- Exit判断
		- 優先度割と高め -> 1分に一度のポーリングではExit/ロスカット/利食い判定が遅すぎて損失につながる
		- まずはロスカットと利食いを実装し後からリアルタイムシグナル解析を実装する
	- ポジショニング判断
		- 優先度中	-> 機会損失にはなるがマイナスに直結することはないのでできればうれしい程度

	- 上記を二つとも実装してしまうとRestAPIでのチャート取得が必要なくなる・・・？
- ロスカット注文後の戦略変更
- DBを実装しデータ解析を可能に（おまけのStatusチェッカでも使える形で)
	- 売買価格とその時のインジケータのStatus
	- 現状の成行決済と決済時に認識している現在価格(これが可視化できると決済注文の指値化のキッカになる)
	

# TODO

- 乖離率算出に用いる価格をRESTAPIからRealTimeAPIへ変更.
- 乖離率が閾値の差異にはSFD戦術に切り替え
	- SFD戦術をチューニングし現実的な勝率になり次第



# Special thanks

このプログラムの元となるコードをGithubで公開してくださった[@tonacoin](https://twitter.com/tonacoin)様に厚くお礼申し上げます。ありがとうございます。


# 免責事項

このプログラムは個人の裁量によりnodeの勉強も兼ねて作成しているものであり、使用者の利益、個人情報などを確実に確保/保護するものではありません。

当ソフトウェアの使用による追証やAPIキー/APIシークレットの盗難等いかなる損害/損失に対する責任を負いかねますのでご理解/ご了承をお願いいたします。

つきましては、利益に関してはプログラムの戦術や動作原理をご理解いただいた上、APIキー等の管理も使用者自身で保護していただきますようお願いいたします。

# ReleaseNote

2018/07/22 ポジショニング時の注文を成行から指値へ		Ver. 0.1.2

2018/07/21 SFDの手数料を目的としたSFDTraderの試作版を導入	Ver None

2018/07/19 デバッグ/リファクタリングで安定性向上		Ver. 0.1.1

2018/07/18 ロスカット/利確注文機能を追加			Ver. 0.1.0

2018/07/13 tonacoin様のノートを参考に稼働可能版が完成 		Ver. 0.0.1
